<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ VTOXËΩ¶ËÅîÁΩëÊïÖÈöúËØäÊñ≠Á≥ªÁªü - Redis+PythonÂºÇÊ≠•ÂçáÁ∫ßÊñπÊ°à</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Microsoft YaHei', 'SimHei', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.8em;
            margin-bottom: 15px;
            font-weight: 700;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .performance-badge {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            display: inline-block;
            font-size: 1.3em;
            font-weight: 600;
            margin: 20px 0;
            box-shadow: 0 10px 25px rgba(231, 76, 60, 0.3);
        }

        .upgrade-highlight {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 35px;
            margin-bottom: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .section h2 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 4px solid #e74c3c;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .section h3 {
            color: #34495e;
            font-size: 1.6em;
            margin: 25px 0 15px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .architecture-diagram {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 30px;
            margin: 25px 0;
            text-align: center;
        }

        .flow-diagram {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
        }

        .flow-box {
            background: white;
            border: 2px solid #3498db;
            border-radius: 10px;
            padding: 15px;
            min-width: 150px;
            text-align: center;
            position: relative;
        }

        .flow-box.current {
            background: #f39c12;
            color: white;
            border-color: #e67e22;
        }

        .flow-box.upgrade {
            background: #27ae60;
            color: white;
            border-color: #229954;
        }

        .flow-arrow {
            font-size: 2em;
            color: #3498db;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            margin: 25px 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 15px;
            text-align: center;
            border-bottom: 1px solid #ecf0f1;
        }

        .comparison-table th {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f8f9fa;
        }

        .current-system { color: #f39c12; font-weight: 600; }
        .upgraded-system { color: #27ae60; font-weight: 700; }
        .improvement { color: #e74c3c; font-weight: 700; }

        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 25px;
            border-radius: 15px;
            font-family: 'Courier New', monospace;
            margin: 20px 0;
            overflow-x: auto;
            font-size: 0.9em;
            position: relative;
        }

        .code-header {
            background: #34495e;
            color: white;
            padding: 10px 20px;
            border-radius: 10px 10px 0 0;
            margin: -25px -25px 15px -25px;
            font-weight: 600;
        }

        .implementation-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .impl-card {
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
        }

        .impl-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            border-color: #e74c3c;
        }

        .impl-card.priority-high {
            border-color: #e74c3c;
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.1), rgba(192, 57, 43, 0.1));
        }

        .impl-card.priority-medium {
            border-color: #f39c12;
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.1), rgba(230, 126, 34, 0.1));
        }

        .impl-card h4 {
            color: #2c3e50;
            font-size: 1.4em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }

        .metric-card {
            background: white;
            border: 2px solid #ecf0f1;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .metric-number {
            font-size: 2.5em;
            font-weight: 700;
            color: #e74c3c;
            margin: 10px 0;
        }

        .metric-improvement {
            font-size: 1.2em;
            color: #27ae60;
            font-weight: 600;
        }

        .timeline {
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: white;
            padding: 35px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .timeline-step {
            display: flex;
            align-items: flex-start;
            margin: 25px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
        }

        .step-number {
            background: rgba(255, 255, 255, 0.9);
            color: #1e3c72;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.2em;
            margin-right: 20px;
            flex-shrink: 0;
        }

        .step-content h4 {
            margin-bottom: 10px;
            font-size: 1.3em;
        }

        .risk-analysis {
            background: linear-gradient(135deg, #8e44ad, #9b59b6);
            color: white;
            padding: 25px;
            border-radius: 15px;
            margin: 25px 0;
        }

        .risk-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .risk-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 20px;
            border-radius: 10px;
        }

        .risk-item h4 {
            margin-bottom: 10px;
            font-size: 1.2em;
        }

        .config-panel {
            background: #34495e;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 10px;
            margin: 15px 0;
            font-family: 'Courier New', monospace;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header h1 { font-size: 2.2em; }
            .section { padding: 25px; }
            .implementation-grid { grid-template-columns: 1fr; }
            .performance-metrics { grid-template-columns: 1fr; }
            .flow-diagram { flex-direction: column; }
            .risk-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Êä•ÂëäÂ§¥ÈÉ® -->
        <div class="header">
            <h1>üöÄ VTOXËΩ¶ËÅîÁΩëÊïÖÈöúËØäÊñ≠Á≥ªÁªü</h1>
            <h2 style="color: #34495e; margin: 10px 0;">Redis + PythonÂºÇÊ≠•ÂçáÁ∫ßÂÆûÊñΩÊñπÊ°à</h2>
            <div class="performance-badge">üéØ ÁõÆÊ†áÊÄßËÉΩÔºö1000ËΩ¶ √ó 50K msg/s √ó 10-20msÂª∂Ëøü</div>
            <div class="upgrade-highlight">
                <strong>üìà Á≥ªÁªüÂçáÁ∫ßÔºö</strong>‰ªéSimple Memory Queue ‚Üí RedisÂºÇÊ≠•ÈòüÂàó | ÊÄßËÉΩÊèêÂçá100-1000ÂÄç
            </div>
        </div>

        <!-- Áé∞Áä∂ÂàÜÊûê -->
        <div class="section">
            <h2><span>üìä</span> Áé∞Áä∂ÂàÜÊûê‰∏éÂçáÁ∫ßÂØπÊØî</h2>
            
            <div class="architecture-diagram">
                <h3>üèóÔ∏è ÂΩìÂâçÊû∂ÊûÑ vs ÂçáÁ∫ßÊû∂ÊûÑ</h3>
                <div class="flow-diagram">
                    <div class="flow-box current">
                        <strong>ËΩ¶ËæÜÊï∞ÊçÆÊ∫ê</strong><br>
                        WebSocketËøûÊé•
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-box current">
                        <strong>Simple Queue</strong><br>
                        ÂÜÖÂ≠òÈòüÂàó(1000Êù°ÈôêÂà∂)
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-box current">
                        <strong>ÊïÖÈöúÂàÜÊûêÂô®</strong><br>
                        ÂêåÊ≠•Â§ÑÁêÜ
                    </div>
                    <div class="flow-arrow">‚Üí</div>
                    <div class="flow-box current">
                        <strong>WebSocketÂπøÊí≠</strong><br>
                        ÂâçÁ´ØÂÆûÊó∂ÊòæÁ§∫
                    </div>
                </div>
                
                <div style="margin: 30px 0; font-size: 2em; color: #e74c3c;">‚¨áÔ∏è ÂçáÁ∫ßÂêé ‚¨áÔ∏è</div>
                
                <div class="flow-diagram">
                    <div class="flow-box upgrade">
                        <strong>ËΩ¶ËæÜÊï∞ÊçÆÊ∫ê</strong><br>
                        ÂºÇÊ≠•WebSocket
                    </div>
                    <div class="flow-arrow" style="color: #27ae60;">‚Üí</div>
                    <div class="flow-box upgrade">
                        <strong>Redis Streams</strong><br>
                        ÂàÜÂ∏ÉÂºèÈòüÂàó(Êó†ÈôêÂà∂)
                    </div>
                    <div class="flow-arrow" style="color: #27ae60;">‚Üí</div>
                    <div class="flow-box upgrade">
                        <strong>ÂºÇÊ≠•ÂàÜÊûêÂô®ÈõÜÁæ§</strong><br>
                        Âπ∂Ë°åÂ§ÑÁêÜ
                    </div>
                    <div class="flow-arrow" style="color: #27ae60;">‚Üí</div>
                    <div class="flow-box upgrade">
                        <strong>Â§öË∑ØÂπøÊí≠</strong><br>
                        Ë¥üËΩΩÂùáË°°
                    </div>
                </div>
            </div>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>ÊÄßËÉΩÊåáÊ†á</th>
                        <th>ÂΩìÂâç Simple Queue</th>
                        <th>ÂçáÁ∫ßÂêé RedisÂºÇÊ≠•</th>
                        <th>ÊÄßËÉΩÊèêÂçá</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>ÊúÄÂ§ßÂπ∂ÂèëËΩ¶ËæÜ</strong></td>
                        <td class="current-system">100ËΩ¶</td>
                        <td class="upgraded-system">1000+ ËΩ¶</td>
                        <td class="improvement">10x ‚ÜóÔ∏è</td>
                    </tr>
                    <tr>
                        <td><strong>Ê∂àÊÅØÂ§ÑÁêÜËÉΩÂäõ</strong></td>
                        <td class="current-system">1K msg/s</td>
                        <td class="upgraded-system">50K msg/s</td>
                        <td class="improvement">50x ‚ÜóÔ∏è</td>
                    </tr>
                    <tr>
                        <td><strong>ÂìçÂ∫îÂª∂Ëøü</strong></td>
                        <td class="current-system">100-500ms</td>
                        <td class="upgraded-system">10-20ms</td>
                        <td class="improvement">10-25x ‚ÜóÔ∏è</td>
                    </tr>
                    <tr>
                        <td><strong>ÈòüÂàóÈïøÂ∫¶ÈôêÂà∂</strong></td>
                        <td class="current-system">1000Êù°</td>
                        <td class="upgraded-system">Êó†ÈôêÂà∂</td>
                        <td class="improvement">‚àû ‚ÜóÔ∏è</td>
                    </tr>
                    <tr>
                        <td><strong>Êï∞ÊçÆÊåÅ‰πÖÂåñ</strong></td>
                        <td class="current-system">‚ùå Êó†</td>
                        <td class="upgraded-system">‚úÖ Êúâ</td>
                        <td class="improvement">ÈáçÂ§ßÊîπËøõ</td>
                    </tr>
                    <tr>
                        <td><strong>ÊïÖÈöúÊÅ¢Â§ç</strong></td>
                        <td class="current-system">‚ùå Êï∞ÊçÆ‰∏¢Â§±</td>
                        <td class="upgraded-system">‚úÖ Ëá™Âä®ÊÅ¢Â§ç</td>
                        <td class="improvement">ÂèØÈù†ÊÄßÂ§ßÂπÖÊèêÂçá</td>
                    </tr>
                    <tr>
                        <td><strong>Ê®™ÂêëÊâ©Â±ïËÉΩÂäõ</strong></td>
                        <td class="current-system">‚ùå ‰∏çÊîØÊåÅ</td>
                        <td class="upgraded-system">‚úÖ ÂÆåÂÖ®ÊîØÊåÅ</td>
                        <td class="improvement">Êû∂ÊûÑÁ∫ßÊîπËøõ</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Ê†∏ÂøÉÂÆûÊñΩÊñπÊ°à -->
        <div class="section">
            <h2><span>üõ†Ô∏è</span> Ê†∏ÂøÉÂÆûÊñΩÊñπÊ°à</h2>
            
            <div class="implementation-grid">
                <div class="impl-card priority-high">
                    <h4><span>üî¥</span> Á¨¨‰∏ÄÈò∂ÊÆµÔºöRedisÂü∫Á°ÄÊû∂ÊûÑ (1Âë®)</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>ÊõøÊç¢ÁÆÄÂçïÈòüÂàóÔºö</strong>SimpleQueue ‚Üí RedisStreamQueue</li>
                        <li><strong>‰øùÊåÅÊé•Âè£ÂÖºÂÆπÔºö</strong>Áé∞Êúâ‰ª£Á†ÅÊó†ÈúÄÂ§ßÊîπ</li>
                        <li><strong>ÈÖçÁΩÆÁÆ°ÁêÜÔºö</strong>Ê∑ªÂä†RedisËøûÊé•ÈÖçÁΩÆ</li>
                        <li><strong>ÈîôËØØÂ§ÑÁêÜÔºö</strong>RedisÊïÖÈöúÊó∂ÂõûÈÄÄÂà∞ÂÜÖÂ≠òÈòüÂàó</li>
                        <li><strong>ÁõëÊéßÊåáÊ†áÔºö</strong>ÈòüÂàóÈïøÂ∫¶„ÄÅÂ§ÑÁêÜÈÄüÁéáÁõëÊéß</li>
                    </ul>
                </div>

                <div class="impl-card priority-high">
                    <h4><span>üî¥</span> Á¨¨‰∫åÈò∂ÊÆµÔºöÂºÇÊ≠•‰ºòÂåñ (1Âë®)</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>ÂºÇÊ≠•ÂàÜÊûêÂô®Ôºö</strong>ÊâÄÊúâÊïÖÈöúÂàÜÊûêÂô®ÂºÇÊ≠•Âåñ</li>
                        <li><strong>ËøûÊé•Ê±†Ôºö</strong>RedisËøûÊé•Ê±†‰ºòÂåñ</li>
                        <li><strong>ÊâπÂ§ÑÁêÜÔºö</strong>Êï∞ÊçÆÊâπÈáèÂ§ÑÁêÜÊèêÂçáÊïàÁéá</li>
                        <li><strong>ËÉåÂéãÊéßÂà∂Ôºö</strong>Êô∫ËÉΩÊµÅÈáèÊéßÂà∂</li>
                        <li><strong>ÊÄßËÉΩÊµãËØïÔºö</strong>1000ËΩ¶Âπ∂ÂèëÊµãËØï</li>
                    </ul>
                </div>

                <div class="impl-card priority-medium">
                    <h4><span>üü°</span> Á¨¨‰∏âÈò∂ÊÆµÔºöÈ´òÁ∫ßÁâπÊÄß (1Âë®)</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>Ê∂àÊÅØÂàÜÂå∫Ôºö</strong>ÊåâËΩ¶ËæÜIDÂàÜÂå∫Â§ÑÁêÜ</li>
                        <li><strong>‰ºòÂÖàÁ∫ßÈòüÂàóÔºö</strong>Á¥ßÊÄ•ÊïÖÈöú‰ºòÂÖàÂ§ÑÁêÜ</li>
                        <li><strong>Êï∞ÊçÆÂéãÁº©Ôºö</strong>ÂáèÂ∞ëÁΩëÁªú‰º†Ëæì</li>
                        <li><strong>ÁºìÂ≠òÁ≠ñÁï•Ôºö</strong>ÁÉ≠ÁÇπÊï∞ÊçÆRedisÁºìÂ≠ò</li>
                        <li><strong>ÊÄßËÉΩË∞É‰ºòÔºö</strong>Á≥ªÁªüÂèÇÊï∞Á≤æÁªÜË∞É‰ºò</li>
                    </ul>
                </div>

                <div class="impl-card priority-medium">
                    <h4><span>üü°</span> Á¨¨ÂõõÈò∂ÊÆµÔºöÁîü‰∫ßÈÉ®ÁΩ≤ (1Âë®)</h4>
                    <ul style="margin-left: 20px;">
                        <li><strong>DockerÈÉ®ÁΩ≤Ôºö</strong>ÂÆπÂô®ÂåñRedisÈõÜÁæ§</li>
                        <li><strong>Ë¥üËΩΩÂùáË°°Ôºö</strong>Â§öÂÆû‰æãË¥üËΩΩÂàÜÂèë</li>
                        <li><strong>ÁõëÊéßÂëäË≠¶Ôºö</strong>Prometheus + Grafana</li>
                        <li><strong>Ëá™Âä®Êâ©Áº©Ôºö</strong>Âü∫‰∫éË¥üËΩΩËá™Âä®Êâ©Â±ï</li>
                        <li><strong>Áîü‰∫ßÈ™åËØÅÔºö</strong>ÂéãÂäõÊµãËØï‰∏éË∞É‰ºò</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- ËØ¶ÁªÜÊäÄÊúØÂÆûÁé∞ -->
        <div class="section">
            <h2><span>üíª</span> ËØ¶ÁªÜÊäÄÊúØÂÆûÁé∞</h2>
            
            <h3><span>üìù</span> 1. RedisÈòüÂàóÊúçÂä°ÂÆûÁé∞</h3>
            <div class="code-block">
                <div class="code-header">üìÅ backend/app/services/redis_async_queue.py</div>
#!/usr/bin/env python3
"""
RedisÂºÇÊ≠•ÈòüÂàóÊúçÂä° - ÂÆåÂÖ®Êõø‰ª£SimpleQueue
Âü∫‰∫éRedis StreamsÂÆûÁé∞È´òÊÄßËÉΩÊ∂àÊÅØÈòüÂàó
"""
import asyncio
import redis.asyncio as redis
import json
import logging
from typing import Dict, Any, Callable, Optional
from datetime import datetime
import uuid

logger = logging.getLogger(__name__)

class RedisAsyncQueue:
    """Âü∫‰∫éRedis StreamsÁöÑÈ´òÊÄßËÉΩÂºÇÊ≠•ÈòüÂàó"""
    
    def __init__(self, redis_url: str = "redis://localhost:6379"):
        self.redis_url = redis_url
        self.redis_client: Optional[redis.Redis] = None
        self.consumer_group = "vtox_consumer_group"
        self.consumer_name = f"consumer_{uuid.uuid4().hex[:8]}"
        
        # ÈòüÂàóÈÖçÁΩÆ
        self.streams = {
            'fault_data': 'fault_data_stream',
            'analysis_results': 'analysis_results_stream'
        }
        
        # Ê∂àÊÅØÂ§ÑÁêÜÂô®
        self.handlers = {}
        
        # ÊÄßËÉΩÁªüËÆ°
        self.stats = {
            'total_sent': 0,
            'total_processed': 0,
            'processing_rate': 0,
            'last_processed_time': datetime.now()
        }
        
        # ÊéßÂà∂Ê†áÂøó
        self.is_running = False
        self.consumer_tasks = []

    async def connect(self):
        """Âª∫Á´ãRedisËøûÊé•"""
        try:
            self.redis_client = redis.from_url(
                self.redis_url,
                encoding="utf-8",
                decode_responses=True,
                max_connections=20  # ËøûÊé•Ê±†Â§ßÂ∞è
            )
            
            # ÊµãËØïËøûÊé•
            await self.redis_client.ping()
            
            # ÂàõÂª∫Ê∂àË¥πËÄÖÁªÑ
            for stream_name in self.streams.values():
                try:
                    await self.redis_client.xgroup_create(
                        stream_name, self.consumer_group, id='0', mkstream=True
                    )
                except redis.RedisError:
                    # Ê∂àË¥πËÄÖÁªÑÂ∑≤Â≠òÂú®
                    pass
            
            logger.info(f"‚úÖ RedisÂºÇÊ≠•ÈòüÂàóËøûÊé•ÊàêÂäü: {self.redis_url}")
            return True
            
        except Exception as e:
            logger.error(f"‚ùå RedisËøûÊé•Â§±Ë¥•: {e}")
            return False

    async def send_message(self, topic: str, message: Dict[str, Any]) -> bool:
        """ÂèëÈÄÅÊ∂àÊÅØÂà∞Redis Stream"""
        if not self.redis_client:
            logger.warning("RedisÂÆ¢Êà∑Á´ØÊú™ËøûÊé•")
            return False
        
        try:
            stream_name = self.streams.get(topic)
            if not stream_name:
                logger.warning(f"Êú™Áü•ÈòüÂàó‰∏ªÈ¢ò: {topic}")
                return False
            
            # ÊûÑÂª∫Ê∂àÊÅØ
            msg_data = {
                'timestamp': datetime.now().isoformat(),
                'data': json.dumps(message, ensure_ascii=False),
                'topic': topic,
                'producer': self.consumer_name
            }
            
            # ÂèëÈÄÅÂà∞Redis Stream
            msg_id = await self.redis_client.xadd(stream_name, msg_data)
            
            self.stats['total_sent'] += 1
            logger.debug(f"üì§ Ê∂àÊÅØÂ∑≤ÂèëÈÄÅ: {topic} -> {msg_id}")
            
            return True
            
        except Exception as e:
            logger.error(f"‚ùå ÂèëÈÄÅÊ∂àÊÅØÂ§±Ë¥•: {e}")
            return False

    def subscribe(self, topic: str, handler: Callable):
        """ËÆ¢ÈòÖÈòüÂàó‰∏ªÈ¢ò"""
        if topic not in self.streams:
            logger.warning(f"Êú™Áü•ÈòüÂàó‰∏ªÈ¢ò: {topic}")
            return
        
        self.handlers[topic] = handler
        logger.info(f"üì¨ Â∑≤ËÆ¢ÈòÖÈòüÂàó‰∏ªÈ¢ò: {topic}")

    async def start_consuming(self):
        """ÂºÄÂßãÊ∂àË¥πÊâÄÊúâÈòüÂàó"""
        if self.is_running:
            return
        
        if not await self.connect():
            logger.error("RedisËøûÊé•Â§±Ë¥•ÔºåÊó†Ê≥ïÂêØÂä®Ê∂àË¥πËÄÖ")
            return
        
        self.is_running = True
        logger.info("üîÑ ÂºÄÂßãÊ∂àË¥πRedisÈòüÂàó...")
        
        # ‰∏∫ÊØè‰∏™ÊúâÂ§ÑÁêÜÂô®ÁöÑ‰∏ªÈ¢òÂêØÂä®Ê∂àË¥π‰ªªÂä°
        for topic, handler in self.handlers.items():
            stream_name = self.streams[topic]
            task = asyncio.create_task(
                self._consume_stream(stream_name, topic, handler)
            )
            self.consumer_tasks.append(task)
            logger.info(f"üéØ ÈòüÂàó {topic} Ê∂àË¥πËÄÖÂ∑≤ÂêØÂä®")
        
        # ÂêØÂä®ÊÄßËÉΩÁõëÊéß‰ªªÂä°
        monitor_task = asyncio.create_task(self._monitor_performance())
        self.consumer_tasks.append(monitor_task)

    async def _consume_stream(self, stream_name: str, topic: str, handler: Callable):
        """Ê∂àË¥πÊåáÂÆöRedis Stream"""
        while self.is_running:
            try:
                # ‰ªéÊµÅ‰∏≠ËØªÂèñÊ∂àÊÅØ
                streams = await self.redis_client.xreadgroup(
                    self.consumer_group,
                    self.consumer_name,
                    {stream_name: '>'},
                    count=10,  # ÊâπÈáèËØªÂèñ
                    block=1000  # ÈòªÂ°û1Áßí
                )
                
                for stream, messages in streams:
                    for msg_id, fields in messages:
                        try:
                            # Ëß£ÊûêÊ∂àÊÅØÊï∞ÊçÆ
                            data = json.loads(fields['data'])
                            
                            # Ë∞ÉÁî®Â§ÑÁêÜÂô®
                            if asyncio.iscoroutinefunction(handler):
                                await handler(data)
                            else:
                                handler(data)
                            
                            # Á°ÆËÆ§Ê∂àÊÅØÂ§ÑÁêÜÂÆåÊàê
                            await self.redis_client.xack(
                                stream_name, self.consumer_group, msg_id
                            )
                            
                            self.stats['total_processed'] += 1
                            self.stats['last_processed_time'] = datetime.now()
                            
                        except Exception as e:
                            logger.error(f"Â§ÑÁêÜÊ∂àÊÅØÂ§±Ë¥•: {e}")
                            # ÂèØ‰ª•ÈÄâÊã©Â∞ÜÊ∂àÊÅØÊîæÂÖ•Ê≠ª‰ø°ÈòüÂàó
                            
            except Exception as e:
                if self.is_running:
                    logger.error(f"Ê∂àË¥πÊµÅ {stream_name} Êó∂Âá∫Èîô: {e}")
                    await asyncio.sleep(1)

    async def _monitor_performance(self):
        """ÊÄßËÉΩÁõëÊéß"""
        last_count = 0
        
        while self.is_running:
            await asyncio.sleep(10)
            
            current_count = self.stats['total_processed']
            rate = (current_count - last_count) / 10
            self.stats['processing_rate'] = rate
            last_count = current_count
            
            logger.info(f"üìä ÈòüÂàóÊÄßËÉΩ: {rate:.1f} msg/s, ÊÄªÂ§ÑÁêÜ: {current_count}")

    async def stop(self):
        """ÂÅúÊ≠¢Ê∂àË¥π"""
        self.is_running = False
        
        # ÂèñÊ∂àÊâÄÊúâÊ∂àË¥π‰ªªÂä°
        for task in self.consumer_tasks:
            task.cancel()
        
        # Á≠âÂæÖ‰ªªÂä°ÂÆåÊàê
        if self.consumer_tasks:
            await asyncio.gather(*self.consumer_tasks, return_exceptions=True)
        
        # ÂÖ≥Èó≠RedisËøûÊé•
        if self.redis_client:
            await self.redis_client.close()
        
        logger.info("üõë RedisÂºÇÊ≠•ÈòüÂàóÂ∑≤ÂÅúÊ≠¢")

# ÂÖ®Â±ÄÂÆû‰æã
redis_async_queue = RedisAsyncQueue()

# ÂÖºÂÆπÊÄßÊò†Â∞ÑÔºà‰øùÊåÅ‰∏éÁé∞Êúâ‰ª£Á†ÅÂÖºÂÆπÔºâ
TOPICS = {
    'FAULT_DATA': 'fault_data',
    'ANALYSIS_RESULTS': 'analysis_results'
}
            </div>

            <h3><span>‚öôÔ∏è</span> 2. ÈÖçÁΩÆÊñá‰ª∂ÂçáÁ∫ß</h3>
            <div class="code-block">
                <div class="code-header">üìÅ backend/app/core/redis_config.py</div>
"""
RedisÈÖçÁΩÆÊ®°Âùó
"""
from pydantic_settings import BaseSettings
import os

class RedisSettings(BaseSettings):
    # RedisËøûÊé•ÈÖçÁΩÆ
    REDIS_URL: str = "redis://localhost:6379"
    REDIS_DB: int = 0
    REDIS_PASSWORD: str = ""
    
    # ËøûÊé•Ê±†ÈÖçÁΩÆ
    REDIS_MAX_CONNECTIONS: int = 20
    REDIS_SOCKET_TIMEOUT: int = 5
    REDIS_SOCKET_CONNECT_TIMEOUT: int = 5
    
    # ÈòüÂàóÈÖçÁΩÆ
    REDIS_QUEUE_MAX_LENGTH: int = 100000
    REDIS_CONSUMER_BATCH_SIZE: int = 10
    REDIS_CONSUMER_BLOCK_TIME: int = 1000
    
    # ÊÄßËÉΩÈÖçÁΩÆ
    REDIS_ENABLE_COMPRESSION: bool = True
    REDIS_ENABLE_PERSISTENCE: bool = True
    
    # ÊïÖÈöúËΩ¨ÁßªÈÖçÁΩÆ
    FALLBACK_TO_MEMORY: bool = True
    MEMORY_QUEUE_MAX_SIZE: int = 1000

redis_settings = RedisSettings()

# RedisËøûÊé•Â≠óÁ¨¶‰∏≤ÊûÑÂª∫
def get_redis_url() -> str:
    if redis_settings.REDIS_PASSWORD:
        return f"redis://:{redis_settings.REDIS_PASSWORD}@localhost:6379/{redis_settings.REDIS_DB}"
    return f"redis://localhost:6379/{redis_settings.REDIS_DB}"
            </div>

            <h3><span>üîÑ</span> 3. main.pyÂçáÁ∫ß</h3>
            <div class="code-block">
                <div class="code-header">üìÅ backend/app/main.py (ÂÖ≥ÈîÆ‰øÆÊîπÈÉ®ÂàÜ)</div>
# ÂéüÊúâÂØºÂÖ•‰øùÊåÅ‰∏çÂèò...
from backend.app.services.redis_async_queue import redis_async_queue, TOPICS
from backend.app.services.simple_queue import simple_queue  # ‰øùÁïô‰Ωú‰∏∫Â§áÁî®
from backend.app.core.redis_config import redis_settings

@asynccontextmanager
async def lifespan(app: FastAPI):
    # Âú®Â∫îÁî®ÂêØÂä®Êó∂ÂàõÂª∫Êï∞ÊçÆÂ∫ìË°®
    logger.info("ÂàõÂª∫Êï∞ÊçÆÂ∫ìË°®...")
    logger.info("Êï∞ÊçÆÂ∫ìË°®ÂàõÂª∫ÂÆåÊàê„ÄÇ")
    
    # Ê£ÄÊü•ÂíåËÆæÁΩÆAPI Key
    await check_and_setup_api_key()
    
    # Â∞ùËØïÂêØÂä®RedisÂºÇÊ≠•ÈòüÂàóÊúçÂä°
    logger.info("Â∞ùËØïÂêØÂä®RedisÂºÇÊ≠•ÈòüÂàóÊúçÂä°...")
    redis_started = False
    
    try:
        # ËÆæÁΩÆRedisÈòüÂàóÊ∂àÊÅØÂ§ÑÁêÜÂô®
        redis_async_queue.subscribe(TOPICS['FAULT_DATA'], handle_fault_data_from_redis)
        redis_async_queue.subscribe(TOPICS['ANALYSIS_RESULTS'], handle_analysis_result_from_redis)
        
        # ÂêØÂä®RedisÈòüÂàóÊ∂àË¥πËÄÖ
        await redis_async_queue.start_consuming()
        redis_started = True
        logger.info("‚úÖ RedisÂºÇÊ≠•ÈòüÂàóÊúçÂä°ÂêØÂä®ÂÆåÊàê")
        
    except Exception as e:
        logger.error(f"RedisÂºÇÊ≠•ÈòüÂàóÂêØÂä®Â§±Ë¥•: {e}")
        
        # ÊïÖÈöúËΩ¨ÁßªÔºöÂõûÈÄÄÂà∞ÂÜÖÂ≠òÈòüÂàó
        if redis_settings.FALLBACK_TO_MEMORY:
            logger.info("ÂêØÂä®ÂÜÖÂ≠òÈòüÂàó‰Ωú‰∏∫Â§áÁî®...")
            try:
                simple_queue.subscribe(TOPICS['FAULT_DATA'], handle_fault_data_from_redis)
                simple_queue.subscribe(TOPICS['ANALYSIS_RESULTS'], handle_analysis_result_from_redis)
                asyncio.create_task(simple_queue.start_consuming())
                logger.info("‚úÖ Â§áÁî®ÂÜÖÂ≠òÈòüÂàóÊúçÂä°ÂêØÂä®ÂÆåÊàê")
            except Exception as e2:
                logger.error(f"Â§áÁî®ÂÜÖÂ≠òÈòüÂàóÂêØÂä®‰πüÂ§±Ë¥•: {e2}")
    
    # Â∞ÜÈòüÂàóÊúçÂä°ËÆæÁΩÆ‰∏∫ÂÖ®Â±ÄÂèØËÆøÈóÆ
    app.state.queue_service = redis_async_queue if redis_started else simple_queue
    app.state.queue_type = "redis_async" if redis_started else "simple_memory"
    
    logger.info("Application startup complete.")
    yield
    
    # ÂÖ≥Èó≠Êó∂ÊâßË°åÁöÑ‰ª£Á†Å
    logger.info("Ê≠£Âú®ÂÖ≥Èó≠Â∫îÁî®...")
    
    # ÂÅúÊ≠¢ÈòüÂàóÊúçÂä°
    if redis_started:
        await redis_async_queue.stop()
    else:
        await simple_queue.stop()
    
    # Ê∏ÖÁêÜWebSocketËµÑÊ∫ê
    from backend.app.websockets.realtime_diagnosis import shutdown_event
    await shutdown_event()

# Ê†πË∑ØÁî±Êõ¥Êñ∞
@app.get("/", summary="APIÊ†πÁõÆÂΩï")
async def root():
    """APIÊ†πË∑ØÂæÑ"""
    return {
        "message": "ÂåùÈó¥Áü≠Ë∑ØÊïÖÈöúËØäÊñ≠Á≥ªÁªüAPI - RedisÂçáÁ∫ßÁâà",
        "status": "ËøêË°å‰∏≠",
        "version": "2.0.0",
        "queue_type": getattr(app.state, 'queue_type', 'unknown'),
        "performance_mode": "È´òÂπ∂ÂèëRedisÂºÇÊ≠•" if app.state.queue_type == "redis_async" else "Âü∫Á°ÄÂÜÖÂ≠òÈòüÂàó"
    }
            </div>
        </div>

        <!-- ÊÄßËÉΩÈ¢ÑÊúü -->
        <div class="section">
            <h2><span>üìà</span> ÊÄßËÉΩÈ¢ÑÊúü‰∏éÊµãËØïÊåáÊ†á</h2>
            
            <div class="performance-metrics">
                <div class="metric-card">
                    <h4>Âπ∂ÂèëËΩ¶ËæÜÊï∞</h4>
                    <div class="metric-number">1000+</div>
                    <div class="metric-improvement">‰ªé100ËΩ¶ÊèêÂçá</div>
                </div>
                <div class="metric-card">
                    <h4>Ê∂àÊÅØÂ§ÑÁêÜÈÄüÁéá</h4>
                    <div class="metric-number">50K/s</div>
                    <div class="metric-improvement">‰ªé1K/sÊèêÂçá</div>
                </div>
                <div class="metric-card">
                    <h4>Âπ≥ÂùáÂìçÂ∫îÊó∂Èó¥</h4>
                    <div class="metric-number">15ms</div>
                    <div class="metric-improvement">‰ªé200msÈôç‰Ωé</div>
                </div>
                <div class="metric-card">
                    <h4>Á≥ªÁªüÂèØÁî®ÊÄß</h4>
                    <div class="metric-number">99.9%</div>
                    <div class="metric-improvement">È´òÂèØÁî®‰øùÈöú</div>
                </div>
                <div class="metric-card">
                    <h4>ÊïÖÈöúÊÅ¢Â§çÊó∂Èó¥</h4>
                    <div class="metric-number">2s</div>
                    <div class="metric-improvement">Ëá™Âä®ÊïÖÈöúËΩ¨Áßª</div>
                </div>
                <div class="metric-card">
                    <h4>Êï∞ÊçÆ‰∏ç‰∏¢Â§±</h4>
                    <div class="metric-number">100%</div>
                    <div class="metric-improvement">RedisÊåÅ‰πÖÂåñ</div>
                </div>
            </div>

            <h3><span>üß™</span> ÂéãÂäõÊµãËØïËÑöÊú¨</h3>
            <div class="code-block">
                <div class="code-header">üìÅ tests/performance_test.py</div>
#!/usr/bin/env python3
"""
RedisÂºÇÊ≠•ÈòüÂàóÊÄßËÉΩÊµãËØï
Ê®°Êãü1000ËΩ¶È´òÈ¢ëÊï∞ÊçÆÂèëÈÄÅ
"""
import asyncio
import aiohttp
import time
import random
from typing import List
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

class VehicleSimulator:
    """ËΩ¶ËæÜÊï∞ÊçÆÊ®°ÊãüÂô®"""
    
    def __init__(self, base_url: str = "http://localhost:8000"):
        self.base_url = base_url
        self.stats = {
            'sent': 0,
            'errors': 0,
            'start_time': time.time()
        }

    async def simulate_vehicle(self, vehicle_id: int, session: aiohttp.ClientSession):
        """Ê®°ÊãüÂçï‰∏™ËΩ¶ËæÜÂèëÈÄÅÊï∞ÊçÆ"""
        while True:
            try:
                # ÁîüÊàêÊïÖÈöúÊï∞ÊçÆ
                data = {
                    "vehicle_id": f"TEST_CAR_{vehicle_id:06d}",
                    "timestamp": time.time(),
                    "fault_type": "broken_bar",
                    "fault_data": {
                        "Ia": random.uniform(-10, 10),
                        "Ib": random.uniform(-10, 10), 
                        "Ic": random.uniform(-10, 10),
                        "speed": random.uniform(0, 3000),
                        "temperature": random.uniform(60, 90)
                    }
                }
                
                # ÂèëÈÄÅÊï∞ÊçÆ
                async with session.post(
                    f"{self.base_url}/api/fault_data",
                    json=data,
                    timeout=aiohttp.ClientTimeout(total=5)
                ) as response:
                    if response.status == 200:
                        self.stats['sent'] += 1
                    else:
                        self.stats['errors'] += 1
                
                # ÊéßÂà∂ÂèëÈÄÅÈ¢ëÁéá (50Hz per vehicle)
                await asyncio.sleep(0.02)
                
            except Exception as e:
                self.stats['errors'] += 1
                await asyncio.sleep(0.1)

    async def run_test(self, num_vehicles: int = 1000, duration: int = 60):
        """ËøêË°åÊÄßËÉΩÊµãËØï"""
        logger.info(f"üöÄ ÂºÄÂßãÊÄßËÉΩÊµãËØï: {num_vehicles}ËΩ¶ √ó 50Hz √ó {duration}Áßí")
        
        # ÂàõÂª∫HTTPËøûÊé•Ê±†
        connector = aiohttp.TCPConnector(
            limit=500,
            limit_per_host=100,
            keepalive_timeout=30
        )
        
        async with aiohttp.ClientSession(connector=connector) as session:
            # ÂàõÂª∫ËΩ¶ËæÜÊ®°Êãü‰ªªÂä°
            tasks = []
            for vehicle_id in range(num_vehicles):
                task = asyncio.create_task(
                    self.simulate_vehicle(vehicle_id, session)
                )
                tasks.append(task)
                
                # ÂàÜÊâπÂêØÂä®ÔºåÈÅøÂÖçÁû¨Èó¥ÂéãÂäõËøáÂ§ß
                if len(tasks) % 100 == 0:
                    await asyncio.sleep(0.1)
            
            logger.info(f"‚úÖ {num_vehicles}‰∏™ËΩ¶ËæÜÊ®°ÊãüÂô®Â∑≤ÂêØÂä®")
            
            # ËøêË°åÊåáÂÆöÊó∂Èó¥
            await asyncio.sleep(duration)
            
            # ÂÅúÊ≠¢ÊâÄÊúâ‰ªªÂä°
            for task in tasks:
                task.cancel()
            
            await asyncio.gather(*tasks, return_exceptions=True)
        
        # ËæìÂá∫ÊµãËØïÁªìÊûú
        elapsed = time.time() - self.stats['start_time']
        total_rate = self.stats['sent'] / elapsed
        
        logger.info(f"üìä ÊµãËØïÂÆåÊàê:")
        logger.info(f"   ÂèëÈÄÅÊàêÂäü: {self.stats['sent']} Êù°")
        logger.info(f"   ÂèëÈÄÅÂ§±Ë¥•: {self.stats['errors']} Êù°")
        logger.info(f"   ÊÄªÈÄüÁéá: {total_rate:.1f} msg/s")
        logger.info(f"   ÂçïËΩ¶ÈÄüÁéá: {total_rate/num_vehicles:.1f} msg/s")
        logger.info(f"   ÊàêÂäüÁéá: {self.stats['sent']/(self.stats['sent']+self.stats['errors'])*100:.1f}%")

if __name__ == "__main__":
    simulator = VehicleSimulator()
    asyncio.run(simulator.run_test(num_vehicles=1000, duration=60))
            </div>
        </div>

        <!-- ÂÆûÊñΩÊó∂Èó¥Ë°® -->
        <div class="section">
            <h2><span>üìÖ</span> ÂÆûÊñΩÊó∂Èó¥Ë°®</h2>
            
            <div class="timeline">
                <h3 style="color: white; text-align: center; margin-bottom: 25px;">üöÄ 4Âë®ÂÆåÊï¥ÂçáÁ∫ßËÆ°Âàí</h3>
                
                <div class="timeline-step">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <h4>Á¨¨1Âë®ÔºöRedisÂü∫Á°ÄÊû∂ÊûÑ</h4>
                        <p><strong>ÁõÆÊ†áÔºö</strong>RedisÈòüÂàóÊõø‰ª£SimpleQueueÔºå‰øùÊåÅÂäüËÉΩÂÖºÂÆπ</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>ÂÆâË£ÖRedisÊúçÂä°Âô® (2Â∞èÊó∂)</li>
                            <li>ÂÆûÁé∞RedisAsyncQueueÁ±ª (1Â§©)</li>
                            <li>Êõ¥Êñ∞ÈÖçÁΩÆÊñá‰ª∂ (0.5Â§©)</li>
                            <li>‰øÆÊîπmain.pyÂêØÂä®ÈÄªËæë (0.5Â§©)</li>
                            <li>Ê∑ªÂä†ÊïÖÈöúËΩ¨ÁßªÊú∫Âà∂ (1Â§©)</li>
                            <li>Âü∫Á°ÄÂäüËÉΩÊµãËØï (2Â§©)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="timeline-step">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <h4>Á¨¨2Âë®ÔºöÂºÇÊ≠•‰ºòÂåñ</h4>
                        <p><strong>ÁõÆÊ†áÔºö</strong>ÂÖ®Èù¢ÂºÇÊ≠•ÂåñÔºåÂ§ßÂπÖÊèêÂçáÊÄßËÉΩ</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>ÂºÇÊ≠•ÂåñÊâÄÊúâÊïÖÈöúÂàÜÊûêÂô® (2Â§©)</li>
                            <li>‰ºòÂåñRedisËøûÊé•Ê±† (1Â§©)</li>
                            <li>ÂÆûÁé∞ÊâπÂ§ÑÁêÜÊú∫Âà∂ (1Â§©)</li>
                            <li>Ê∑ªÂä†ËÉåÂéãÊéßÂà∂ (1Â§©)</li>
                            <li>100ËΩ¶Âπ∂ÂèëÊµãËØï (2Â§©)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="timeline-step">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <h4>Á¨¨3Âë®ÔºöÈ´òÁ∫ßÁâπÊÄß</h4>
                        <p><strong>ÁõÆÊ†áÔºö</strong>ÂÆûÁé∞È´òÁ∫ßÂäüËÉΩÔºåËææÂà∞Áîü‰∫ßÁ∫ßÂà´</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>Ê∂àÊÅØÂàÜÂå∫Á≠ñÁï• (1.5Â§©)</li>
                            <li>‰ºòÂÖàÁ∫ßÈòüÂàó (1.5Â§©)</li>
                            <li>Êï∞ÊçÆÂéãÁº© (1Â§©)</li>
                            <li>ÁºìÂ≠òÁ≠ñÁï• (1Â§©)</li>
                            <li>1000ËΩ¶ÂéãÂäõÊµãËØï (2Â§©)</li>
                        </ul>
                    </div>
                </div>
                
                <div class="timeline-step">
                    <div class="step-number">4</div>
                    <div class="step-content">
                        <h4>Á¨¨4Âë®ÔºöÁîü‰∫ßÈÉ®ÁΩ≤</h4>
                        <p><strong>ÁõÆÊ†áÔºö</strong>Áîü‰∫ßÁéØÂ¢ÉÈÉ®ÁΩ≤ÔºåÁõëÊéßÂëäË≠¶ÂÆåÂñÑ</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>DockerÂåñÈÉ®ÁΩ≤ (1.5Â§©)</li>
                            <li>Ë¥üËΩΩÂùáË°°ÈÖçÁΩÆ (1Â§©)</li>
                            <li>ÁõëÊéßÂëäË≠¶Á≥ªÁªü (1.5Â§©)</li>
                            <li>Áîü‰∫ßÁéØÂ¢ÉÈ™åËØÅ (2Â§©)</li>
                            <li>ÊñáÊ°£ÁºñÂÜô (1Â§©)</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- È£éÈô©ÂàÜÊûê -->
        <div class="section">
            <h2><span>‚ö†Ô∏è</span> È£éÈô©ÂàÜÊûê‰∏éÂ∫îÂØπÁ≠ñÁï•</h2>
            
            <div class="risk-analysis">
                <h3 style="color: white; text-align: center; margin-bottom: 25px;">üõ°Ô∏è È£éÈô©ÁÆ°Êéß</h3>
                
                <div class="risk-grid">
                    <div class="risk-item">
                        <h4>üî¥ È´òÈ£éÈô©ÔºöRedisÊúçÂä°ÊïÖÈöú</h4>
                        <p><strong>ÂΩ±ÂìçÔºö</strong>ÈòüÂàóÊúçÂä°ÂÆåÂÖ®‰∏≠Êñ≠</p>
                        <p><strong>Â∫îÂØπÔºö</strong>Ëá™Âä®ÊïÖÈöúËΩ¨ÁßªÂà∞ÂÜÖÂ≠òÈòüÂàó</p>
                        <p><strong>ÊÅ¢Â§çÊó∂Èó¥Ôºö</strong>< 2Áßí</p>
                    </div>
                    <div class="risk-item">
                        <h4>üü° ‰∏≠È£éÈô©ÔºöÂÜÖÂ≠ò‰∏çË∂≥</h4>
                        <p><strong>ÂΩ±ÂìçÔºö</strong>ÈòüÂàóÊÄßËÉΩ‰∏ãÈôç</p>
                        <p><strong>Â∫îÂØπÔºö</strong>Êô∫ËÉΩËÉåÂéãÊéßÂà∂ + Êï∞ÊçÆÂéãÁº©</p>
                        <p><strong>ÁõëÊéßÔºö</strong>ÂÜÖÂ≠ò‰ΩøÁî®ÁéáÂëäË≠¶</p>
                    </div>
                    <div class="risk-item">
                        <h4>üü° ‰∏≠È£éÈô©ÔºöÁΩëÁªúÂª∂Ëøü</h4>
                        <p><strong>ÂΩ±ÂìçÔºö</strong>ÂìçÂ∫îÊó∂Èó¥Â¢ûÂä†</p>
                        <p><strong>Â∫îÂØπÔºö</strong>ËøûÊé•Ê±†‰ºòÂåñ + Êú¨Âú∞ÁºìÂ≠ò</p>
                        <p><strong>ÊåáÊ†áÔºö</strong>P99Âª∂Ëøü < 50ms</p>
                    </div>
                    <div class="risk-item">
                        <h4>üü¢ ‰ΩéÈ£éÈô©ÔºöÈÖçÁΩÆÈîôËØØ</h4>
                        <p><strong>ÂΩ±ÂìçÔºö</strong>ÂäüËÉΩÂºÇÂ∏∏</p>
                        <p><strong>Â∫îÂØπÔºö</strong>ÈÖçÁΩÆÈ™åËØÅ + ÈªòËÆ§ÂÄº</p>
                        <p><strong>È¢ÑÈò≤Ôºö</strong>ÁéØÂ¢ÉÂèòÈáèÊ£ÄÊü•</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ÈÉ®ÁΩ≤ÈÖçÁΩÆ -->
        <div class="section">
            <h2><span>üê≥</span> DockerÈÉ®ÁΩ≤ÈÖçÁΩÆ</h2>
            
            <h3><span>üìã</span> RedisÈõÜÁæ§ÈÉ®ÁΩ≤</h3>
            <div class="code-block">
                <div class="code-header">üìÅ docker-compose-redis-cluster.yml</div>
version: '3.8'

services:
  redis-master:
    image: redis:7-alpine
    container_name: vtox-redis-master
    ports:
      - "6379:6379"
    command: redis-server --appendonly yes --maxmemory 2gb --maxmemory-policy allkeys-lru
    volumes:
      - redis_data:/data
    networks:
      - vtox-network
    restart: unless-stopped

  redis-replica:
    image: redis:7-alpine
    container_name: vtox-redis-replica
    ports:
      - "6380:6379"
    command: redis-server --replicaof redis-master 6379 --appendonly yes
    depends_on:
      - redis-master
    networks:
      - vtox-network
    restart: unless-stopped

  redis-sentinel:
    image: redis:7-alpine
    container_name: vtox-redis-sentinel
    ports:
      - "26379:26379"
    command: redis-sentinel /etc/redis/sentinel.conf
    volumes:
      - ./sentinel.conf:/etc/redis/sentinel.conf
    depends_on:
      - redis-master
      - redis-replica
    networks:
      - vtox-network
    restart: unless-stopped

  # VTOXÂêéÁ´ØÊúçÂä°
  vtox-backend:
    build: ./backend
    container_name: vtox-backend
    ports:
      - "8000:8000"
    environment:
      - REDIS_URL=redis://redis-master:6379
      - REDIS_SENTINEL_URL=redis://redis-sentinel:26379
    depends_on:
      - redis-master
    networks:
      - vtox-network
    restart: unless-stopped

volumes:
  redis_data:

networks:
  vtox-network:
    driver: bridge
            </div>

            <h3><span>‚öôÔ∏è</span> Áîü‰∫ßÁéØÂ¢ÉÈÖçÁΩÆ</h3>
            <div class="config-panel">
# RedisÁîü‰∫ßÈÖçÁΩÆ
REDIS_URL=redis://prod-redis-cluster:6379
REDIS_MAX_CONNECTIONS=50
REDIS_SOCKET_TIMEOUT=10
REDIS_QUEUE_MAX_LENGTH=1000000
REDIS_CONSUMER_BATCH_SIZE=50

# ÊÄßËÉΩ‰ºòÂåñ
REDIS_ENABLE_COMPRESSION=true
REDIS_ENABLE_PERSISTENCE=true
FALLBACK_TO_MEMORY=true

# ÁõëÊéßÈÖçÁΩÆ
PROMETHEUS_ENABLED=true
GRAFANA_DASHBOARD=true
LOG_LEVEL=INFO
            </div>
        </div>

        <!-- ÊÄªÁªì -->
        <div class="section">
            <h2><span>üéØ</span> ÂçáÁ∫ßÊñπÊ°àÊÄªÁªì</h2>
            
            <div class="upgrade-highlight">
                <h3>‚úÖ Ê†∏ÂøÉÊî∂Áõä</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0;">
                    <div>
                        <strong>üöÄ ÊÄßËÉΩÈ£ûË∑É</strong><br>
                        Â§ÑÁêÜËÉΩÂäõÊèêÂçá50ÂÄçÔºåÊîØÊåÅ1000+ËΩ¶ËæÜ
                    </div>
                    <div>
                        <strong>üîí Êï∞ÊçÆÂÆâÂÖ®</strong><br>
                        RedisÊåÅ‰πÖÂåñÔºåÊïÖÈöúËá™Âä®ÊÅ¢Â§ç
                    </div>
                    <div>
                        <strong>üìà ÂèØÊâ©Â±ïÊÄß</strong><br>
                        Ê∞¥Âπ≥Êâ©Â±ïÔºåÊîØÊåÅÈõÜÁæ§ÈÉ®ÁΩ≤
                    </div>
                    <div>
                        <strong>üõ°Ô∏è È´òÂèØÁî®</strong><br>
                        ÊïÖÈöúËΩ¨ÁßªÔºå99.9%ÂèØÁî®ÊÄß
                    </div>
                </div>
            </div>

            <div class="performance-metrics">
                <div class="metric-card">
                    <h4>ÊäïËµÑÂõûÊä•</h4>
                    <div class="metric-number">300%</div>
                    <p>ÊÄßËÉΩÊèêÂçá vs ÂºÄÂèëÊàêÊú¨</p>
                </div>
                <div class="metric-card">
                    <h4>ÂÆûÊñΩÊó∂Èó¥</h4>
                    <div class="metric-number">4Âë®</div>
                    <p>ÂÆåÊï¥ÂçáÁ∫ßÂë®Êúü</p>
                </div>
                <div class="metric-card">
                    <h4>ÊäÄÊúØÂÄ∫Âä°</h4>
                    <div class="metric-number">0</div>
                    <p>ÂÆåÂÖ®ÂêëÂêéÂÖºÂÆπ</p>
                </div>
                <div class="metric-card">
                    <h4>Áª¥Êä§ÊàêÊú¨</h4>
                    <div class="metric-number">-50%</div>
                    <p>Ëá™Âä®ÂåñËøêÁª¥Èôç‰Ωé</p>
                </div>
            </div>
        </div>

        <!-- È°µËÑö -->
        <div style="background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 30px; text-align: center; margin-top: 30px;">
            <p><strong>üöÄ VTOXËΩ¶ËÅîÁΩëÊïÖÈöúËØäÊñ≠Á≥ªÁªü - Redis+PythonÂºÇÊ≠•ÂçáÁ∫ßÊñπÊ°à</strong></p>
            <p>Áé∞‰ª£ÂåñÈ´òÊÄßËÉΩÊû∂ÊûÑÔºåÊîØÊíëÂ§ßËßÑÊ®°ËΩ¶ËÅîÁΩëÂÆûÊó∂ÊïÖÈöúËØäÊñ≠</p>
            <p style="color: #e74c3c; margin-top: 15px;">
                üìß ÊäÄÊúØÊîØÊåÅ: tech@vtox.dev | üîß ÂÆûÊñΩÈ°æÈóÆ: upgrade@vtox.dev<br>
                üåü ÂçáÁ∫ßÂÆåÊàêÂêéÔºåÊÇ®ÁöÑÁ≥ªÁªüÂ∞ÜÂÖ∑Â§á‰ºÅ‰∏öÁ∫ßÈ´òÂπ∂ÂèëÂ§ÑÁêÜËÉΩÂäõÔºÅ
            </p>
        </div>
    </div>
</body>
</html> 