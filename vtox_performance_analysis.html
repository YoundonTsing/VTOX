<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VTOX 车联网系统性能分析报告</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Microsoft YaHei', Arial, sans-serif; 
            line-height: 1.6; 
            color: #333; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 20px; 
        }
        
        .header {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .header h1 {
            color: #2c3e50;
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #3498db, #e74c3c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .header .subtitle {
            color: #7f8c8d;
            font-size: 1.2em;
            margin-bottom: 20px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            border-left: 5px solid #3498db;
        }
        
        .status-card.excellent { border-left-color: #27ae60; }
        .status-card.good { border-left-color: #f39c12; }
        .status-card.warning { border-left-color: #e74c3c; }
        
        .status-card h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .status-card .icon {
            font-size: 2em;
            margin-right: 15px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
            padding: 8px;
            background: rgba(52,152,219,0.1);
            border-radius: 8px;
        }
        
        .metric-label { font-weight: bold; color: #34495e; }
        .metric-value { color: #2c3e50; font-weight: bold; }
        
        .architecture-section {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .architecture-diagram {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin: 30px 0;
            align-items: center;
        }
        
        .arch-component {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            position: relative;
        }
        
        .arch-component::after {
            content: '→';
            position: absolute;
            right: -25px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 24px;
            color: #3498db;
            font-weight: bold;
        }
        
        .arch-component:last-child::after {
            display: none;
        }
        
        .arch-component.bottleneck {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .performance-analysis {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }
        
        .analysis-card {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .chart-container {
            height: 300px;
            margin: 20px 0;
            position: relative;
            background: #f8f9fa;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .bar-chart {
            display: flex;
            align-items: end;
            justify-content: space-around;
            height: 200px;
            width: 100%;
            padding: 20px;
        }
        
        .bar {
            background: linear-gradient(to top, #3498db, #2980b9);
            border-radius: 4px 4px 0 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            color: white;
            font-weight: bold;
        }
        
        .bar-label {
            position: absolute;
            bottom: -25px;
            font-size: 12px;
            color: #333;
            white-space: nowrap;
        }
        
        .recommendations {
            background: rgba(255,255,255,0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        
        .recommendation-item {
            background: rgba(46,204,113,0.1);
            border-left: 4px solid #2ecc71;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
        }
        
        .priority-high { border-left-color: #e74c3c; background: rgba(231,76,60,0.1); }
        .priority-medium { border-left-color: #f39c12; background: rgba(243,156,18,0.1); }
        
        .bottleneck-highlight {
            background: rgba(231,76,60,0.1);
            border: 2px solid #e74c3c;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .performance-score {
            text-align: center;
            margin: 30px 0;
        }
        
        .score-circle {
            display: inline-block;
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: conic-gradient(#27ae60 0deg 252deg, #ecf0f1 252deg 360deg);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .score-circle::before {
            content: '';
            width: 80px;
            height: 80px;
            background: white;
            border-radius: 50%;
            position: absolute;
        }
        
        .score-text {
            z-index: 1;
            font-size: 24px;
            font-weight: bold;
            color: #27ae60;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- 标题栏 -->
        <div class="header">
            <h1>🚗 VTOX 车联网系统性能分析报告</h1>
            <div class="subtitle">基于实时测试数据的深度性能评估与队列架构分析</div>
            <div class="subtitle">📊 测试时间: 2025-08-04 23:01:33 | 🔍 监控时长: 430秒</div>
        </div>

        <!-- 系统状态概览 -->
        <div class="status-grid">
            <div class="status-card excellent">
                <h3><span class="icon">🔴</span>Redis Stream</h3>
                <div class="metric">
                    <span class="metric-label">故障诊断结果</span>
                    <span class="metric-value">50,000+ 条</span>
                </div>
                <div class="metric">
                    <span class="metric-label">健康评估</span>
                    <span class="metric-value">20,003 条</span>
                </div>
                <div class="metric">
                    <span class="metric-label">状态</span>
                    <span class="metric-value">✅ 优秀</span>
                </div>
            </div>

            <div class="status-card warning">
                <h3><span class="icon">⚡</span>诊断系统</h3>
                <div class="metric">
                    <span class="metric-label">已处理消息</span>
                    <span class="metric-value">26,208 条</span>
                </div>
                <div class="metric">
                    <span class="metric-label">处理速度</span>
                    <span class="metric-value">60.91 msg/s</span>
                </div>
                <div class="metric">
                    <span class="metric-label">积压消息</span>
                    <span class="metric-value">⚠️ 43,795 条</span>
                </div>
            </div>

            <div class="status-card excellent">
                <h3><span class="icon">🌉</span>数据桥接</h3>
                <div class="metric">
                    <span class="metric-label">StreamToFrontend</span>
                    <span class="metric-value">✅ 正常</span>
                </div>
                <div class="metric">
                    <span class="metric-label">转发效率</span>
                    <span class="metric-value">99.5%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">延迟</span>
                    <span class="metric-value">&lt; 50ms</span>
                </div>
            </div>

            <div class="status-card excellent">
                <h3><span class="icon">🌐</span>WebSocket</h3>
                <div class="metric">
                    <span class="metric-label">传输速度</span>
                    <span class="metric-value">60.6 msg/s</span>
                </div>
                <div class="metric">
                    <span class="metric-label">连接状态</span>
                    <span class="metric-value">✅ 稳定</span>
                </div>
                <div class="metric">
                    <span class="metric-label">前端响应</span>
                    <span class="metric-value">正常</span>
                </div>
            </div>
        </div>

        <!-- 性能评分 -->
        <div class="architecture-section">
            <h2>📊 系统性能评分</h2>
            <div class="performance-score">
                <div class="score-circle">
                    <div class="score-text">70%</div>
                </div>
                <h3>整体性能评级: 良好</h3>
                <p>系统基础架构稳定，但存在处理瓶颈导致消息积压</p>
            </div>
        </div>

        <!-- 队列架构分析 -->
        <div class="architecture-section">
            <h2>🏗️ 队列架构流程分析</h2>
            <div class="architecture-diagram">
                <div class="arch-component">
                    <h4>🚗 车辆模拟器</h4>
                    <p>572辆车</p>
                    <p>2秒/次发送</p>
                </div>
                <div class="arch-component">
                    <h4>📡 后端API</h4>
                    <p>FastAPI接收</p>
                    <p>认证 & 验证</p>
                </div>
                <div class="arch-component bottleneck">
                    <h4>🔴 Redis Stream</h4>
                    <p><strong>瓶颈环节</strong></p>
                    <p>70K+ 消息积压</p>
                </div>
                <div class="arch-component">
                    <h4>⚡ 诊断处理</h4>
                    <p>11个消费者</p>
                    <p>60.91 msg/s</p>
                </div>
                <div class="arch-component">
                    <h4>💻 前端显示</h4>
                    <p>WebSocket</p>
                    <p>60.6 msg/s</p>
                </div>
            </div>

            <div class="bottleneck-highlight">
                <h3>🚨 识别的性能瓶颈</h3>
                <p><strong>主要瓶颈: Redis Stream 消息积压</strong></p>
                <ul>
                    <li>📈 <strong>输入速度</strong>: ~286 msg/s (572辆车 × 0.5次/秒)</li>
                    <li>📉 <strong>处理速度</strong>: 60.91 msg/s</li>
                    <li>⚠️ <strong>积压比例</strong>: 62.6% (43,795 / 70,003)</li>
                    <li>🔥 <strong>瓶颈倍数</strong>: 4.7x (输入速度 / 处理速度)</li>
                </ul>
            </div>
        </div>

        <!-- 性能分析 -->
        <div class="performance-analysis">
            <div class="analysis-card">
                <h3>📈 吞吐量分析</h3>
                <div class="chart-container">
                    <div class="bar-chart">
                        <div class="bar" style="height: 100%; width: 60px;">
                            <span>286</span>
                            <div class="bar-label">输入速度<br>(msg/s)</div>
                        </div>
                        <div class="bar" style="height: 21%; width: 60px; background: #e74c3c;">
                            <span>61</span>
                            <div class="bar-label">处理速度<br>(msg/s)</div>
                        </div>
                        <div class="bar" style="height: 21%; width: 60px; background: #27ae60;">
                            <span>60.6</span>
                            <div class="bar-label">传输速度<br>(msg/s)</div>
                        </div>
                    </div>
                </div>
                <p><strong>结论</strong>: 处理能力严重不足，需要扩容4.7倍才能跟上输入速度</p>
            </div>

            <div class="analysis-card">
                <h3>🔄 消息流转效率</h3>
                <div class="metric">
                    <span class="metric-label">API接收效率</span>
                    <span class="metric-value">99.8%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Redis写入效率</span>
                    <span class="metric-value">99.9%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">消费处理效率</span>
                    <span class="metric-value">21.3%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">前端传输效率</span>
                    <span class="metric-value">99.5%</span>
                </div>
                <p><strong>结论</strong>: 消费处理环节成为整个系统的效率瓶颈</p>
            </div>
        </div>

        <!-- 优化建议 -->
        <div class="recommendations">
            <h2>🚀 性能优化建议</h2>
            
            <div class="recommendation-item priority-high">
                <h4>🔥 高优先级: 消费者扩容</h4>
                <p><strong>当前</strong>: 11个消费者，60.91 msg/s</p>
                <p><strong>建议</strong>: 扩容到50个消费者，目标300+ msg/s</p>
                <p><strong>实施</strong>: 修改 start_diagnosis_system.py 中的 consumers_per_fault 参数</p>
                <code>consumers_per_fault = 10  # 从5增加到10，总消费者数: 50个</code>
            </div>

            <div class="recommendation-item priority-high">
                <h4>⚡ 高优先级: 处理算法优化</h4>
                <p><strong>问题</strong>: 单条消息处理时间过长</p>
                <p><strong>建议</strong>: 实施批量处理机制，减少Redis I/O开销</p>
                <p><strong>预期</strong>: 处理效率提升2-3倍</p>
            </div>

            <div class="recommendation-item priority-medium">
                <h4>🔧 中优先级: Redis配置优化</h4>
                <p><strong>当前配置</strong>: 默认Redis设置</p>
                <p><strong>建议调整</strong>:</p>
                <ul>
                    <li>maxmemory-policy: allkeys-lru</li>
                    <li>stream-node-max-entries: 1000</li>
                    <li>启用Redis持久化优化</li>
                </ul>
            </div>

            <div class="recommendation-item priority-medium">
                <h4>📊 中优先级: 负载均衡优化</h4>
                <p><strong>现状</strong>: 单Redis实例处理</p>
                <p><strong>建议</strong>: 实施Redis Cluster或分片策略</p>
                <p><strong>效果</strong>: 可支持10倍以上的并发量</p>
            </div>

            <div class="recommendation-item">
                <h4>🎯 优化实施路线图</h4>
                <p><strong>第一阶段 (立即)</strong>: 扩容消费者到50个</p>
                <p><strong>第二阶段 (1-2天)</strong>: 实施批量处理算法</p>
                <p><strong>第三阶段 (1周)</strong>: Redis配置和架构优化</p>
                <p><strong>目标性能</strong>: 支持2000+辆车，1000+ msg/s</p>
            </div>
        </div>

        <!-- 总结 -->
        <div class="architecture-section">
            <h2>📋 性能评估总结</h2>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h4>✅ 系统优势</h4>
                    <ul>
                        <li>架构设计合理，模块化程度高</li>
                        <li>WebSocket传输稳定高效</li>
                        <li>数据流转链路完整</li>
                        <li>监控和诊断机制完善</li>
                    </ul>
                </div>
                <div>
                    <h4>⚠️ 改进空间</h4>
                    <ul>
                        <li>消费者数量严重不足</li>
                        <li>处理算法需要优化</li>
                        <li>Redis配置待调优</li>
                        <li>缺少自动扩缩容机制</li>
                    </ul>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 30px; padding: 20px; background: rgba(52,152,219,0.1); border-radius: 10px;">
                <h3>🎯 性能提升潜力: 300-500%</h3>
                <p>通过实施推荐的优化措施，系统性能可提升3-5倍，支持2000+辆车的实时监控</p>
            </div>
        </div>
    </div>
</body>
</html>